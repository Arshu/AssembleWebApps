
<script type="text/javascript">

    window.ajaxid = 0;

    function fillAppRegions(progressElmId, responseElmId, regionTemplateElmId, regionTargetElmId, successCallback) {
        let id = window.ajaxid++;
        let responseElm = getElm(responseElmId);
        let responseContainerElmId = responseElmId + "Container";
        responseElm.textContent = '';
        hideElm(responseContainerElmId);

        let valid = true;

        if (valid === true) {

            let isRealtime = false;
            let realtimeDomain = "";

            let apiUrl = '/AppApi/CurlApi';
            let apiMethod = 'GetServerRegionInfo';

            let apiParams = {};

            let processReturn = function (result, responseElmId, successCallback) {

                let responseElm = getElm(responseElmId);

                if (result.hasOwnProperty('error') === true) {
                    showText(responseElm, result.error, 'red');
                }
                else if (result.hasOwnProperty('message') === true) {
                    //showText(responseElm, result.message, 'green');

                    if (typeof successCallback === "function") {
                        successCallback();
                    }
                }
                else if (result.hasOwnProperty('data') === true) {

                    let data = result.data;
                    let currentRegion = "sin";
                    if (result.hasOwnProperty("info") === true) {
                        currentRegion = result.info;
                    }
                    //let appName = "appweb";
                    //if (result.hasOwnProperty('name') === true) {
                    //    appName = result.name;
                    //    getElm('appName').value = "https://" + appName + ".fly.dev";
                    //}

                    let templateElm = getElm(regionTemplateElmId);
                    let templateHtml = templateElm.innerHTML;

                    let regionTemplate = "";
                    for (var i = 0; i < data.length; i++) {
                        let regionName = data[i];

                        let templateItem = templateHtml;
                        if (regionName == currentRegion) {
                            templateItem = templateItem.replace(/{AppRegion}/g, 'appRegion')
                            templateItem = templateItem.replace(/{Region}/g, regionName)
                        } else {
                            templateItem = templateItem.replace(/{AppRegion}/g, 'appRegion')
                            templateItem = templateItem.replace(/{Region}/g, regionName)
                            templateItem = templateItem.replace(/checked="checked"/g, "")
                        }

                        regionTemplate = regionTemplate + templateItem;
                    }
                    let targetElm = getElm(regionTargetElmId);
                    targetElm.innerHTML = regionTemplate;

                    if (typeof successCallback === "function") {
                        successCallback();
                    }
                }
            };

            callAssemblerApi(progressElmId, responseElmId, apiUrl, apiMethod, apiParams, isRealtime, realtimeDomain, processReturn, successCallback, 0, "{{$AppSite}}", "{{$AppView}}", "{{$ViewName}}", "");
        }

        return false;
    }

    function appListSelectAll(regionTargetElmId, checkedState) {
        var regionCheckboxes = document.getElementsByName(regionTargetElmId);
        for (var i = 0; i < regionCheckboxes.length; i++) {
            regionCheckboxes[i].checked = checkedState;
        }
    }

</script>

