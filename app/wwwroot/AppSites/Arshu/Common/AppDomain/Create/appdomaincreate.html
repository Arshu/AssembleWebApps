{{@IsSubDomain}}
<script type="text/javascript">
    function showAppDomainViewer(progressElmId) {
        alert('New App Domain Creation cannot be done from App Domain')
    }
</script>
{{/IsSubDomain}}
{{^IsSubDomain}}
<script type="text/javascript">

    window.ajaxid = 0;

    function hideAppDomainViewer() {

        let modal = document.querySelector('#viewAppDomain');
        modal.classList.remove('is-active');
    }

    function showAppDomainViewer(progressElmId) {
        clearResponse('telDomainRegisterResponse');
        let modal = document.querySelector('#viewAppDomain');
        modal.classList.add('is-active');
        let phoneNoElm = getElm('phoneNo');
        phoneNoElm.focus();
    }

    function clearResponse(responseElmId) {
        getElm(responseElmId).textContent = "";
        let responseContainerElmId = responseElmId + "Container";
        hideElm(responseContainerElmId);
    }

    function registerAppDomainHost(responseElmId, progressElmId, countryPhonePrefixVal, phoneNoVal, aliasDomainName, adminEmailVal, adminPwdVal, targetElmId, successCallback) {

        let id = window.ajaxid++;
        let responseElm = getElm(responseElmId);
        responseElm.textContent = '';
        let responseContainerElmId = responseElmId + "Container";
        hideElm(responseContainerElmId);
        let valid = true;

        if (valid == true) {
            if (countryPhonePrefixVal.trim().length === 0) {
                responseElm.textContent = 'Select Country Phone Prefix';
                responseElm.style.color = "red";
                showAutoHideFlex(responseContainerElmId);
                valid = false;
            }
        }

        if (valid == true) {
            if (phoneNoVal.trim().length === 0) {
                responseElm.textContent = 'Enter Phone No';
                responseElm.style.color = "red";
                showAutoHideFlex(responseContainerElmId);
                valid = false;
            }
        }

        if (valid == true) {
            if (adminEmailVal.trim().length === 0) {
                responseElm.textContent = 'Enter Admin Email';
                responseElm.style.color = "red";
                showAutoHideFlex(responseContainerElmId);
                valid = false;
            }
        }

        if (valid == true) {
            if (adminPwdVal.trim().length === 0) {
                responseElm.textContent = 'Enter Admin Password';
                responseElm.style.color = "red";
                showAutoHideFlex(responseContainerElmId);
                valid = false;
            }
            else if (adminPwdVal.trim().length < 5) {
                responseElm.textContent = 'Enter Admin Password of Min 5 Characters';
                responseElm.style.color = "red";
                showAutoHideFlex(responseContainerElmId);
                valid = false;
            }
        }

        let telDomainName = countryPhonePrefixVal + phoneNoVal;

        if (valid === true) {

            let url = '/AppApi/DomainApi';
            let urlMethod = 'POST';
            let urlContent = {
                "jsonrpc": '2.0', "method": 'RegisterAppDomainHost', "params": {
                    "appDomainName": telDomainName,
                    "appDomainAdminEmail": adminEmailVal,
                    "appDomainAdminPwd": adminPwdVal,
                    "appDomainAlias": aliasDomainName,
                    "appDomainTitle": telDomainName,
                    "appDomainDescription": telDomainName
                }, "id": id
            };

            dopost(progressElmId, responseElmId, url, urlContent,
                function (data) {
                    if (data.hasOwnProperty('Result') === true) {
                        let result = data.Result;
                        if (result.hasOwnProperty('error') === true) {
                            showText(responseElm, result.error, 'red');
                        }
                        else if (result.hasOwnProperty('message') === true) {
                            showText(responseElm, result.message, 'green');
                        }

                        if (result.hasOwnProperty('data') === true) {
                            let rootNode = getElm(targetElmId);
                            rootNode.setAttribute("href", result.data);
                            rootNode.innerHTML = "Instance:" + result.data;

                            setTimeout(function () {
                                window.location.href = result.data;
                                //window.open(result.data, '_blank');
                            }, 1000);

                            if (typeof successCallback === "function") {
                                successCallback();
                            }
                        }
                    }
                    else if (data.hasOwnProperty('Error') === true) {
                        let error = data.Error;
                        if (error.hasOwnProperty('Message') === true) {
                            showText(responseElm, error.Message, 'red');
                        }
                    }
                });

        }

        return false;
    }

    function registerRandomAppDomainHost(responseElmId, progressElmId, adminEmailVal, adminPwdVal, targetElmId, successCallback) {

        let id = window.ajaxid++;
        let responseElm = getElm(responseElmId);
        responseElm.textContent = '';
        let responseContainerElmId = responseElmId + "Container";
        hideElm(responseContainerElmId);
        let valid = true;

        if (valid === true) {

            let url = '/AppApi/DomainApi';
            let urlMethod = 'POST';
            let urlContent = {
                "jsonrpc": '2.0', "method": 'RegisterRandomAppDomainHost', "params": {
                    "appDomainName": "",
                    "appDomainAdminEmail": adminEmailVal,
                    "appDomainAdminPwd": adminPwdVal
                }, "id": id
            };

            dopost(progressElmId, responseElmId, url, urlContent,
                function (data) {
                    if (data.hasOwnProperty('Result') === true) {
                        let result = data.Result;
                        if (result.hasOwnProperty('error') === true) {
                            showText(responseElm, result.error, 'red');
                        }
                        else if (result.hasOwnProperty('message') === true) {
                            showText(responseElm, result.message, 'green');
                        }

                        if (result.hasOwnProperty('data') === true) {
                            let rootNode = getElm(targetElmId);
                            rootNode.setAttribute("href", result.data);
                            rootNode.innerHTML = "Instance:" + result.data;

                            setTimeout(function () { window.location.href = result.data; }, 1000);

                            if (typeof successCallback === "function") {
                                successCallback();
                            }
                        }
                    }
                    else if (data.hasOwnProperty('Error') === true) {
                        let error = data.Error;
                        if (error.hasOwnProperty('Message') === true) {
                            showText(responseElm, error.Message, 'red');
                        }
                    }
                });

        }

        return false;
    }

    ready(() => {

        if (haveElm('phoneNo') == true) {

            let phoneNoElm = getElm('phoneNo');
            phoneNoElm.addEventListener('keypress', function (event) {
                let key = event.which || event.keyCode;
                if ((key === 13) && (phoneNoElm.value.length >= 8)) { // 13 is enter
                    adminEmail.focus();
                }
            });
            let adminEmailElm = getElm('adminEmail');
            adminEmailElm.addEventListener('keypress', function (event) {
                let key = event.which || event.keyCode;
                if ((key === 13) && (adminEmailElm.value.length >= 8)) { // 13 is enter
                    //triggerEvent('btnRegisterAppDomain', 'click');
                    adminPwd.focus();
                }
            });
            let adminPwdElm = getElm('adminPwd');
            adminPwdElm.addEventListener('keypress', function (event) {
                let key = event.which || event.keyCode;
                if ((key === 13) && (adminPwdElm.value.length >= 5)) { // 13 is enter
                    triggerEvent('btnRegisterAppDomain', 'click');
                }
            });
            //phoneNoElm.focus();
        }
    });

    function setPhonePrefix() {
        let phonePrefix = getElm('countryPhonePrefix').value;
        getElm('phonePrefix').textContent = phonePrefix;
    }

</script>

<div class="modal" id="viewAppDomain">
    <div class="modal-background"></div>
    <div class="modal-content">

        <div class="flex-card border" style="text-align:center;padding:3px 10px;background-color:#fff;">

            <div style="padding:3px 10px;background-color:#fff;text-align:right;">
                <button class="border" style="width:25px;height:25px;background-color: lightgray;" onclick="hideAppDomainViewer()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
            <div style="position:relative;text-align:center;height:0px;">
                <div id="viewAppDomainProgress"></div>
            </div>

            <div class="notification is-marginless" id="viewAppDomainResponseContainer" style="display:none;">
                <button class="delete" onclick="hideElm('viewAppDomainResponseContainer');"></button>
                <div id="viewAppDomainResponse"></div>
            </div>

            <h6 style="color:red;">Demo AppDomain's' will be auto deleted periodically</h6>
            <div>
                <div class="flex-content-wrap" style="margin-top:10px;">
                    <button class="border-left" style="width:100px;height:40px;background-color:lightgray;font-size:small;" onclick="$('#phoneNo').val('');">
                        Country
                    </button>
                    <div class="flex-item-stretch border-right" style="height:40px;">
                        <select id="countryPhonePrefix" style="width:100%;border:none;font-size:small;" onchange="setPhonePrefix()">
                            {{@CountryPhoneList}}
                            <option id="{{$CountryCode}}" value="Phone No +{{$CountryExtension}}" country="{{$CountryName}}" {{$Selected}}>{{$CountryName}}</option>
                            {{/CountryPhoneList}}
                            {{@HaveAdminRole}}
                            <option value="Domain">Any</option>
                            {{/HaveAdminRole}}
                        </select>
                    </div>
                </div>
                <div class="flex-content-wrap" style="margin-top:10px;">
                    <button class="border-left" style="width:100px;height:40px;background-color:lightgray;font-size:small;" onclick="getElm('phoneNo').value = '';">
                        <span href="#" id="phonePrefix">PhoneNo +65</span>
                    </button>
                    <div class="flex-item-stretch border-top-bottom">
                        <input style="width:100%;height:38px;border:none;font-size:small;" id="phoneNo" {{@HaveAdminRole}} type="text" placeholder="Domain Name" {{/HaveAdminRole}} {{^HaveAdminRole}} type="number" placeholder="Phone Number" {{/HaveAdminRole}} value="" tabindex="1" />
                    </div>
                    <button class="border-right" style="width:40px;height:40px;">
                        <svg xmlns="http://www.w3.org/2000/svg" id="opendown" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"
                             onclick="toggleElm('opendown'); toggleElm('closeup'); toggleElm('aliasInfo');">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19 13l-7 7-7-7m14-8l-7 7-7-7" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" id="closeup" style="display:none;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"
                             onclick="toggleElm('opendown');toggleElm('closeup');toggleElm('aliasInfo');">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 11l7-7 7 7M5 19l7-7 7 7" />
                        </svg>
                    </button>
                </div>

                <h6>Validated Phone No is used to uniquely identify your demo AppDomain</h6>

                <div id="aliasInfo" style="display:none;">
                    <div class="flex-content-wrap" style="margin-top:5px;">
                        <button class="border-left" style="width:100px;height:40px;background-color:lightgray;font-size:small;" onclick="getElm('adminEmail').value = '';">
                            Domain Alias
                        </button>
                        <div class="flex-item-stretch border-right">
                            <input style="width:100%;height:38px;border:none;font-size:small;" id="domainAlias" type="text" placeholder="Enter Domain Alias" value="" tabindex="2" />
                        </div>
                    </div>
                </div>
                <div id="securityInfo">
                    <div class="flex-content-wrap" style="margin-top:5px;">
                        <button class="border-left" style="width:100px;height:40px;background-color:lightgray;font-size:small;" onclick="getElm('adminEmail').value = '';">
                            Admin Email
                        </button>
                        <div class="flex-item-stretch border-right">
                            <input style="width:100%;height:38px;border:none;font-size:small;" id="adminEmail" type="text" placeholder="Enter Admin Email" value="" tabindex="3" />
                        </div>
                    </div>
                    <div class="flex-content-wrap" style="margin-top:5px;">
                        <button class="border-left" style="width:100px;height:40px;background-color:lightgray;font-size:small;" onclick="getElm('adminPwd').value = '';">
                            Admin Pwd
                        </button>
                        <div class="flex-item-stretch border-right">
                            <input style="width:100%;height:38px;border:none;font-size:small;" id="adminPwd" type="password" placeholder="Enter Admin Pwd" value="" tabindex="4" />
                        </div>
                    </div>
                </div>

                <div class="flex-item-stretch" style="margin: 5px 0px;">
                    <a id="telDomainInfo" style="color:red;" href="#"></a>
                </div>

                <div class="flex-content-wrap" style="margin: 5px 0px;">
                    <button class="border button is-info" id="btnRegisterAppDomain" style="margin:5px;cursor:pointer;height:40px;" onclick="registerAppDomainHost('telDomainRegisterResponse', 'telDomainRegisterProgress', getElm('countryPhonePrefix').value, getElm('phoneNo').value, getElm('domainAlias').value, getElm('adminEmail').value, getElm('adminPwd').value, 'telDomainInfo', null);">
                        Create Own Demo AppDomain<div id="telDomainRegisterProgress"></div>
                    </button>
                </div>

                <div>
                    <div class="flex-item-stretch" style="margin: 5px 0px;">
                        OR
                    </div>

                    <h6 style="color:blue;">Demo Admin Id : <span style="color:red;">{{$DemoAdminUserID}}</span>, Password: <span style="color:red;">{{$DemoAdminUserPwd}}</span></h6>
                    <div class="flex-content-wrap" style="margin: 2px 0px;">
                        <button class="border button is-primary" style="margin:5px;cursor:pointer;height:40px;" onclick="registerRandomAppDomainHost('telDomainRegisterResponse', 'telDomainRegisterProgress', '{{$DemoAdminUserID}}', '{{$DemoAdminUserPwd}}', 'telDomainInfo', null);">
                            Try Shared Demo AppDomain
                        </button>
                    </div>
                    <h6 style="color:red;">Warning: Others may also use shared demo appdomain.</h6>
                </div>

                <div class="notification" id="telDomainRegisterResponseContainer" style="margin:5px; padding:10px;text-align:justify;display:none;">
                    <button class="delete" onclick="hideElm('telDomainRegisterResponseContainer')"></button>
                    <div id="telDomainRegisterResponse"></div>
                </div>
            </div>

        </div>

    </div>
</div>
{{/IsSubDomain}}

