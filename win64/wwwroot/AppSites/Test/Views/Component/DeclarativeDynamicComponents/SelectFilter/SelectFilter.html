<script>
    ready(() => {
        filterAddListeners();
    });

    function filterAddListeners() {

        if (haveElm('newFilterSection{{$ViewID}}')) {
            var newFilterTextElm = getElm('newFilterText{{$ViewID}}');
            var newFilterAddBtnElm = getElm('newFilterAddBtn{{$ViewID}}');

            newFilterTextElm.addEventListener('keypress', function (event) {
                var key = event.which || event.keyCode;
                if (key === 13) { // 13 is enter
                    if (haveElm('newFilterValue{{$ViewID}}')) {
                        var newFilterValueElm = getElm('newFilterValue{{$ViewID}}');
                        newFilterValueElm.focus();
                    } else {
                        newFilterAddBtnElm.click();
                    }
                }
            });
        }

        if (haveElm('newFilterValue{{$ViewID}}')) {
            var newFilterValueElm = getElm('newFilterValue{{$ViewID}}');

            newFilterValueElm.addEventListener('keypress', function (event) {
                var key = event.which || event.keyCode;
                if (key === 13) { // 13 is enter
                    newFilterAddBtnElm.click();
                }
            });
        }

        if (haveElm('{{$ParentViewID}}RefreshBtn')) {
            triggerEvent('{{$ParentViewID}}RefreshBtn', 'click');
        }
    }

    function filterGetAddJson() {
        var jsonData = getViewComponentFlatJson('newFilterSection{{$ViewID}}');
        return jsonData;
    }

    function filterGetEditJson() {
        var jsonData = new Object();
        var selectElm = getElm('{{$ParentViewID}}ListFilterSelect');
        var selectedOptionElm = selectElm.options[selectElm.selectedIndex];
        var dataRow = selectedOptionElm.getAttribute('data-row');
        if (dataRow != '0') {
            var jsonKey = 'ListFilter.FilterList~' + dataRow + '.ItemSelected';
            jsonData[jsonKey] = true;
        }
        return jsonData;
    }

    function filterGetDeleteKeyPath() {
        var jsonData = '';
        var selectElm = getElm('{{$ParentViewID}}ListFilterSelect');
        var selectedOptionElm = selectElm.options[selectElm.selectedIndex];
        var dataRow = selectedOptionElm.getAttribute('data-row');
        if (dataRow != '0') {
            jsonData = 'ListFilter.FilterList~' + dataRow + '.ItemText';
        }
        return jsonData;
    }

</script>
<div class="border" style="margin:5px 10px;">
    <div class="flex-input-wrap" style="margin: 5px 10px;text-align:center;position:relative">
        {{VIEWPLACEHOLDER}}
        <button style="position:absolute; right:-12px;margin-top:-8px;width:25px;height:25px;background-color: transparent;text-align:center;vertical-align:middle;" onclick="showComponentSourceViewer('selectFilterShowProgress', '{{$ViewID}}', true)">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
            </svg><div id="selectFilterShowProgress"></div>
        </button>

        <label for="{{$ViewID}}Select" style="width:100%;">{{$ListFilterName}}</label>
        <button class="border-left" style="width:40px;height:40px;"
                onclick="{{%FilterRefreshView}}">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
        </button>
        <div class="flex-item-stretch border-top-bottom" style="height:40px;">
            <select style="width:100%;border:none;" id="{{$ParentViewID}}ListFilterSelect" data-key="List.List~0.Category"
                    onchange="{{%FilterEditViewData}}">
                {{@FilterList}}
                <option data-row="{{$RowNo}}" value="{{$ItemValue}}" {{@ItemSelected}} selected {{/ItemSelected}}>
                    {{$ItemText}}
                </option>
                {{/FilterList}}
            </select>
        </div>
        <button class="border-right" style="width:40px;height:40px;" onclick="toggleElm('newFilterSection{{$ViewID}}');">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
        </button>
    </div>
    <div class="flex-item-stretch" style="width: 100%;">
        <span style="font-size:xx-small">ViewID:[{{$ViewID}}] ParentViewID:[{{$ParentViewID}}] NextParentViewID:[{{$NextParentViewID}}]</span>
    </div>
    {{SelectFilterAdd}}
</div>