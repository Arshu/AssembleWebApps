
<script type="text/javascript">

    window.ajaxid = 0;

    function refreshAppDomainList(progressElmId, responseElmId, targetElmId, selectedKeyVal, successCallback) {
        let id = window.ajaxid++;
        let responseElm = getElm(responseElmId);
        let responseContainerElmId = responseElmId + "Container";
        responseElm.textContent = '';
        hideElm(responseContainerElmId);
        let valid = true;

        if (valid === true) {


            let url = '/AppApi/AppApi';
            let urlContent = {
                "jsonrpc": '2.0', "method": 'GetAppDomainSelectView', "params": {
                    "selectEmptyText": "No App Domins Found",
                    "selectedKey": selectedKeyVal,
                    "filterKey": "",
                    "skipValue": "",
                    "appendOptionText": "",
                    "appendOptionValue": ""
                }, "id": id
            };

            dopost(progressElmId, responseElmId, url, urlContent,
                function (data) {
                    if ((data.hasOwnProperty('Result') === true) && (data.Result)) {
                        let result = data.Result;
                        if (result.hasOwnProperty('html') === true) {
                            let rootNode = getElm(targetElmId);
                            rootNode.innerHTML = result.html;
                            showElm(targetElmId);

                            if (typeof successCallback === "function") {
                                successCallback();
                            }
                        }
                        if (result.hasOwnProperty('error') === true) {
                            showText(responseElm, result.error, 'red');
                        }
                        //else if (result.hasOwnProperty('message') === true) {
                        //    showText(responseElm, result.message, 'green');
                        //}
                    }
                    else if ((data.hasOwnProperty('Error') === true) && (data.Error)) {
                        let error = data.Error;
                        if (error.hasOwnProperty('Message') === true) {
                            showText(responseElm, error.Message, 'red');
                        }
                    }
                });
        }

        return false;
    }

    function switchAppDomain(progressElmId, responseElmId, appDomainName, successCallback) {

        let id = window.ajaxid++;

        let responseContainerElmId = responseElmId + "Container";
        let responseElm = getElm(responseElmId)
        let responseContainerElm = getElm(responseContainerElmId)
        while (responseElm.firstChild) responseElm.removeChild(responseElm.firstChild);
        hideElm(responseContainerElmId);

        let valid = true;

        if (appDomainName.length === 0) {
            showText(responseElm, 'Select AppDomain Name', 'red');
            valid = false;
        }

        if (valid == true) {

            let url = '/AppApi/AppApi';
            let urlMethod = 'POST';
            let urlContent = {
                "jsonrpc": '2.0', "method": "SwitchAppDomain",
                "params": {
                    "appDomainName": appDomainName
                },
                "id": id
            };

            dopost(progressElmId, responseElmId, url, urlContent,
                function (data) {
                    if ((data.hasOwnProperty('Result') === true) && (data.Result)) {
                        let result = data.Result;

                        if (result.hasOwnProperty('message') === true) {
                            showText(responseElm, result.message, 'green');

                            if (typeof successCallback === "function") {
                                successCallback();
                            }

                            setTimeout(function () { window.location.href = "/"; }, 1000);
                        }
                        else if (result.hasOwnProperty('error') === true) {
                            showText(responseElm, result.error, 'red');
                        }
                    }
                    else if ((data.hasOwnProperty('Error') === true) && (data.Error)) {
                        let error = data.Error;
                        if (error.hasOwnProperty('Message') === true) {
                            showText(responseElm, error.Message, 'red');
                        }
                    }
                });
        }

    }

</script>
<div class="flex-content-wrap" style="padding:3px 10px;background-color:#fff;">
    <label style="width:100%;text-align:center">App Domain Name</label>
    <div class="flex-item-stretch border-left" style="height:40px;">
        <select style="width:100%;border:none;" id="appDomainNameList">
            {{
                VIEW_AppDomainSelect(
                "AppDomainList",
                "SkipValue" : "",
                "FilterValue": "",
                "SelectedKey":"{$RootFolder}",
                "SelectEmptyText":"No App Domain Found",
                "AppendOption" : "",
                "AppendOptionValue" : "")
            }}
        </select>
    </div>
    <button class="border-right" style="width:40px;height:40px;" id="refreshFromAppDomainListBtn" onclick="refreshAppDomainList('appDomainProgress', 'appDomainResponse', 'appDomainNameList', getElm('appDomainNameList').value, function () {  });">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
        <div id="appDomainProgress"></div>
    </button>
</div>

<div class="flex-content-wrap" style="padding:3px 10px;background-color:#fff;">
    <div class="notification" id="appDomainResponseContainer" style="padding:10px;text-align:justify;display:none;">
        <button class="delete" onclick="hideElm('appDomainResponseContainer')"></button>
        <div id="appDomainResponse"></div>
    </div>
</div>

<div class="flex-content-wrap" style="padding: 5px 0px;background-color:#fff;">

    <button class="border button" style="background-color:#209cee;margin-right:5px;"
            onclick="switchAppDomain('switchProgress', 'appDomainResponse', getElm('appDomainNameList').value, function () { });">
        Switch AppDomain <div id="switchProgress"></div>
    </button>

</div>
