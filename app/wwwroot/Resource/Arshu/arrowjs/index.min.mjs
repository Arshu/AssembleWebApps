const e=new Set,n=new Set;function c(c){if(!e.size)return c&&c(),Promise.resolve();let s;const u=new Promise((r=>{s=r}));return n.add((()=>{c&&c(),s()})),u}function s(e){return"function"==typeof e&&!!e.isT}function u(e){return"object"==typeof e&&null!==e&&"$on"in e&&"function"==typeof e.$on}function l(e){return"$on"in e}function i(c){return(s,u)=>{e.size||queueMicrotask((function c(){const l=Array.from(e);e.clear();const i=Array.from(n);n.clear(),l.forEach((e=>e(s,u))),i.forEach((e=>e())),e.size&&queueMicrotask(c)})),e.add(c)}}const a={};function f(e,n){const c=performance.now(),s="function"==typeof n;e=s?`${e} (ms)`:`${e} (calls)`;const u=s?n():n,l=s?performance.now()-c:n;return a[e]?a[e].push(l):a[e]=[l],u}const p=new Map;function r(e,n={}){if(u(e)||"object"!=typeof e)return e;const c=n.o||new Map,s=n.op||new Map,l=Array.isArray(e),i=[],a=l?[]:Object.create(e,{});for(const n in e){const c=e[n];"object"==typeof c&&null!==c?(a[n]=u(c)?c:r(c),i.push(n)):a[n]=c}const f=e=>(n,u)=>{let l=c.get(n),i=s.get(u);l||(l=new Set,c.set(n,l)),i||(i=new Set,s.set(u,i)),l[e](u),i[e](n)},$on=f("add"),$off=f("delete"),_em=(e,n,s)=>{c.has(e)&&c.get(e).forEach((e=>e(n,s)))},p={$on,$off,_em,_st:()=>({o:c,op:s,r:a,p:g._p}),_p:void 0},g=new Proxy(a,{has:(e,key)=>key in p||key in e,get(...e){const[,n]=e;if(Reflect.has(p,n))return Reflect.get(p,n);const c=Reflect.get(...e);return d(g,n),l&&n in Array.prototype?h(n,a,g,c):c},set(...e){const[n,c,s]=e,l=Reflect.get(n,c);if(Reflect.has(p,c))return Reflect.set(p,c,s);if(s&&u(l)){const o=l,e=o._st(),i=u(s)?m(s,o):r(s,e);return Reflect.set(n,c,i),_em(c,i),e.o.forEach(((e,n)=>{const c=Reflect.get(l,n),s=Reflect.get(i,n);c!==s&&o._em(n,s,c)})),!0}const i=Reflect.set(...e);return i&&(l!==s&&_em(c,s,l),g._p&&g._p[1]._em(...g._p)),i}});return n.p&&(g._p=n.p),i.map((e=>{g[e]._p=[e,g]})),g}function d(e,n){p.forEach((c=>{let s=c.get(e);s||(s=new Set,c.set(e,s)),s.add(n)}))}function h(op,e,n,c){const s=(...c)=>{const s=Array.prototype[op].call(e,...c);if(e.forEach(((e,c)=>n._em(String(c),e))),n._p){const[e,c]=n._p;c._em(e,n)}return s};switch(op){case"shift":case"pop":case"sort":case"reverse":case"copyWithin":return s;case"unshift":case"push":case"fill":return(...e)=>s(...e.map((e=>r(e))));case"splice":return function(e,n,...c){return 1===arguments.length?s(e):s(e,n,...c.map((e=>r(e))))};default:return c}}function m(e,n){const c=n._st();return c.o&&c.o.forEach(((n,c)=>{n.forEach((n=>{e.$on(c,n)}))})),c.p&&(e._p=c.p),e}function g(e,n){const c=Symbol();p.has(c)||p.set(c,new Map);let s=new Map;const u=i(a);function a(){p.set(c,new Map);const l=e(),i=p.get(c);return p.delete(c),s.forEach(((e,n)=>{const c=i.get(n);c&&c.forEach((n=>e.delete(n))),e.forEach((e=>n.$off(e,u)))})),i.forEach(((e,n)=>{e.forEach((e=>n.$on(e,u)))})),s=i,n?n(l):l}return l(e)&&e.$on(a),a()}const y=new WeakMap,E={},_="➳❍",v="❍⇚",x=`\x3c!--${_}--\x3e`,b=`\x3c!--${v}--\x3e`;function t(e,...n){const c=[];let s="";const u=(e,html)=>{if("function"==typeof e){let n=()=>{};return c.push(Object.assign(((...n)=>e(...n)),{e,$on:e=>{n=e},_up:exp=>{e=exp,n()}})),html+x}return Array.isArray(e)?e.reduce(((html,exp)=>u(exp,html)),html):html+e},l=()=>(s||(s=n.length||1!==e.length||""!==e[0]?e.reduce((function(html,e,c){return html+=e,void 0!==n[c]?u(n[c],html):html}),""):"\x3c!----\x3e"),s),i=e=>{const n=w(R(l()),{i:0,e:c});return e?n(e):n()};return i.isT=!0,i._k=0,i._h=()=>[l(),c,i._k],i.key=key=>(i._k=key,i),i}function w(dom,e){let n,c=0;const s=dom.childNodes;for(;n=s.item(c++);)8!==n.nodeType||n.nodeValue!==_?(n instanceof Element&&A(n,e),n.hasChildNodes()&&w(n,e),n instanceof HTMLOptionElement&&(n.selected=n.defaultSelected)):M(n,e);return e=>e?(e.appendChild(dom),e):dom}function A(e,n){var c;const s=[];let u,l=0;for(;u=e.attributes[l++];){if(n.i>=n.e.length)return;if(u.value!==x)continue;let i=u.name;const a=n.e[n.i++];if("@"===i.charAt(0)){const n=i.substring(1);e.addEventListener(n,a),y.has(e)||y.set(e,new Map),null===(c=y.get(e))||void 0===c||c.set(n,a),s.push(i)}else{const n="value"===i&&"value"in e||"checked"===i||i.startsWith(".")&&(i=i.substring(1));g(a,(c=>{n&&(e[i]=c,e.getAttribute(i)!=c&&(c=!1)),!1!==c?e.setAttribute(i,c):(e.removeAttribute(i),l--)}))}}s.forEach((n=>e.removeAttribute(n)))}function $(e){e.forEach(k)}function k(e){var n;e.remove(),null===(n=y.get(e))||void 0===n||n.forEach(((n,c)=>e.removeEventListener(c,n)))}function M(e,n){var c;const u=n.e[n.i++];let l;if(u&&s(u.e))l=T().add(u.e)();else{let e;l=(e=g(u,(n=>S(n,e))))()}null===(c=e.parentNode)||void 0===c||c.replaceChild(l,e)}function S(e,n){const c="function"==typeof n,s=c?n:T();return Array.isArray(e)?e.forEach((e=>f("partialAdd",(()=>s.add(e))))):s.add(e),c&&s._up(),s}function R(html){var e;const dom=(null!==(e=E[html])&&void 0!==e?e:(()=>{const tpl=document.createElement("template");return tpl.innerHTML=html,E[html]=tpl})()).content.cloneNode(!0);return dom.normalize(),dom}function T(e=Symbol()){let html="",n={i:0,e:[]},c=[],u=[];const l=new Map,i=[],a=()=>{let dom;if(c.length||p(),1!==c.length||s(c[0].tpl))dom=d(w(R(html),n)());else{const e=c[0];e.dom.length?e.dom[0].nodeValue=e.tpl:e.dom.push(document.createTextNode(e.tpl)),dom=e.dom[0]}return f(),dom};a.ch=()=>u,a.l=0,a.add=tpl=>{if(!tpl&&0!==tpl)return a;let key,e=[],u="";s(tpl)&&([u,e,key]=tpl._h()),html+=u,html+=b;const i=key&&l.get(key),f=i||{html:u,exp:e,dom:[],tpl,key};return c.push(f),key&&(i?i.exp.forEach(((exp,n)=>exp._up(e[n].e))):l.set(key,f)),n.e.push(...e),a.l++,a},a._up=()=>{const n=T(e);let s=0,l=u[0].dom[0];c.length||p(document.createComment(""));const a=()=>{if(!n.l)return;const e=n(),u=e.lastChild;l[s?"after":"before"](e),h(n,c,s),l=u};c.forEach(((e,c)=>{const f=u[c];e.key&&e.dom.length?(a(),f&&f.dom===e.dom||l[c?"after":"before"](...e.dom),l=e.dom[e.dom.length-1]):f&&e.html===f.html&&!f.key?(a(),f.exp.forEach(((n,c)=>n._up(e.exp[c].e))),e.exp=f.exp,e.dom=f.dom,l=e.dom[e.dom.length-1],j(e)&&l instanceof Text&&(l.nodeValue=e.tpl)):(f&&e.html!==f.html&&!f.key&&i.push(...f.dom),n.l||(s=c),n.add(e.tpl))})),a();let d=null==l?void 0:l.nextSibling;for(;d&&e in d;){i.push(d);d=d.nextSibling}$(i),f()};const f=()=>{i.length=0,html="",a.l=0,n={i:0,e:[]},u=[...c],c=[]},p=e=>{html="\x3c!----\x3e",c.push({html,exp:[],dom:e?[e]:[],tpl:t`${html}`,key:0})},d=n=>{let s=0;const u=[];return n.childNodes.forEach((n=>{if(8===n.nodeType&&n.data===v)return s++,void u.push(n);Object.defineProperty(n,e,{value:e}),c[s].dom.push(n)})),u.forEach((e=>e.remove())),n},h=(e,n,c)=>{e.ch().forEach(((e,s)=>{n[c+s].dom=e.dom}))};return a}function j(e){return 1===e.dom.length&&!s(e.tpl)}const html=t,N=r,C=g;export{html,a as measurements,c as nextTick,r,N as reactive,t,g as w,C as watch};
//# sourceMappingURL=index.min.js.map